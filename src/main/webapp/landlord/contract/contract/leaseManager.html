<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>租赁信息管理</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="../../../layuiadmin/layui/css/layui.css" media="all">
	<link rel="stylesheet" href="../../../layuiadmin/layui/css/public.css" media="all">
</head>

<body>
	<div class="layuimini-container">
		<div class="layuimini-main">
			<!--搜索开始-->
			<fieldset class="layui-elem-field layuimini-search">
				<legend>搜索信息</legend>
				<div style="margin: 10px 10px 10px 10px">
					<form class="layui-form layui-form-pane" action="" id="searchFrm">
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">编号</label>
								<div class="layui-input-inline">
									<input type="text" name="houseCode" autocomplete="off" class="layui-input">
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">地址</label>
								<div class="layui-input-inline">
									<input type="text" name="address" autocomplete="off" class="layui-input">
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">价格</label>
								<div class="layui-input-inline">
									<input type="text" name="price" autocomplete="off" class="layui-input">
								</div>
							</div>
							<div class="layui-inline">
								<a class="layui-btn " lay-submit="" lay-filter="data-search-btn"><label
										class="layui-icon layui-icon-search"></label>搜索</a>
								<a class="layui-btn layui-btn-warm"
									onclick="javascript:$('#searchFrm')[0].reset();$('#deptid').val('')"
									lay-filter="data-search-btn">
									<label class="layui-icon layui-icon-refresh"></label>重置</a>
							</div>
						</div>
					</form>
				</div>
			</fieldset>
			<!--搜索结束-->

			<!--表格开始-->
			<table class="layui-hide" id="userTable" lay-filter="userTable"></table>
			<script type="text/html" id="userToolBar">
				        <a class="layui-btn layui-btn-sm" lay-event="add">添加</a>
				    </script>
			<script type="text/html" id="userTableBar">
						<a class="layui-btn layui-btn-xs layui-btn-warm data-count-delete" lay-event="checkContract">查看合同</a>
					    <a class="layui-btn layui-btn-xs layui-btn-danger data-count-delete" lay-event="delete">删除</a>
					</script>


			<script type="text/html" id="availableTpl">
					<!-- 这里的 checked 的状态只是演示 -->
			<input type="checkbox" name="available" value="{{d.id}}" lay-skin="switch" lay-text="可用|不可用"
				lay-filter="availableSwitch" {{ d.available == 1 ? 'checked' : '' }}>
			</script>
			<!--表格结束-->

			<!--添加和修改的弹出层开始-->
			<div id="addOrUpdateDiv" style="display: none;padding: 0.3125rem">
				<form method="post" class="layui-form layui-form-pane" lay-filter="dataFrm" id="dataFrm">
					<p>
					<h3>一、总则</h3>
					1.1 保宝网的所有权和运营权归深圳市永兴元科技有限公司所有。<br>
					1.2 用户在注册之前，应当仔细阅读本协议，并同意遵守本协议后方可成为注册用户。一旦注册成功，则用户与保宝网之间自动形成协议关系，用户应当受本协议的约束。用户在使用特殊的服务或产品时，应当同意接受相关协议后方能使用。<br>
					1.3 本协议则可由保宝网随时更新，用户应当及时关注并同意本站不承担通知义务。本站的通知、公告、声明或其它类似内容是本协议的一部分。<br>
					<h3>二、服务内容</h3>
					2.1 保宝网的具体内容由本站根据实际情况提供。<br>
					2.2 本站仅提供相关的网络服务，除此之外与相关网络服务有关的设备(如个人电脑、手机、及其他与接入互联网或移动网有关的装置)及所需的费用(如为接入互联网而支付的电话费及上网费、为使用移动网而支付的手机费)均应由用户自行负担。<br>
					<h3>三、用户帐号</h3>
					3.1 经本站注册系统完成注册程序并通过身份认证的用户即成为正式用户，可以获得本站规定用户所应享有的一切权限；未经认证仅享有本站规定的部分会员权限。保宝网有权对会员的权限设计进行变更。<br>
					3.2 用户只能按照注册要求使用真实姓名，及身份证号注册。用户有义务保证密码和帐号的安全，用户利用该密码和帐号所进行的一切活动引起的任何损失或损害，由用户自行承担全部责任，本站不承担任何责任。如用户发现帐号遭到未授权的使用或发生其他任何安全问题，应立即修改帐号密码并妥善保管，如有必要，请通知本站。因黑客行为或用户的保管疏忽导致帐号非法使用，本站不承担任何责任。<br>
					<h3>四、使用规则</h3>
					4.1 遵守中华人民共和国相关法律法规，包括但不限于《中华人民共和国计算机信息系统安全保护条例》、《计算机软件保护条例》、《最高人民法院关于审理涉及计算机网络著作权纠纷案件适用法律若干问题的解释(法释[2004]1号)》、《全国人大常委会关于维护互联网安全的决定》、《互联网电子公告服务管理规定》、《互联网新闻信息服务管理规定》、《互联网著作权行政保护办法》和《信息网络传播权保护条例》等有关计算机互联网规定和知识产权的法律和法规、实施办法。<br>
					4.2 用户对其自行发表、上传或传送的内容负全部责任，所有用户不得在本站任何页面发布、转载、传送含有下列内容之一的信息，否则本站有权自行处理并不通知用户：<br>
					(1)违反宪法确定的基本原则的；<br>
					(2)危害国家安全，泄漏国家机密，颠覆国家政权，破坏国家统一的；<br>
					(3)损害国家荣誉和利益的；<br>
					(4)煽动民族仇恨、民族歧视，破坏民族团结的；<br>
					(5)破坏国家宗教政策，宣扬邪教和封建迷信的；<br>
					(6)散布谣言，扰乱社会秩序，破坏社会稳定的；<br>
					(7)散布淫秽、色情、赌博、暴力、恐怖或者教唆犯罪的；<br>
					(8)侮辱或者诽谤他人，侵害他人合法权益的；<br>
					(9)煽动非法集会、结社、游行、示威、聚众扰乱社会秩序的；<br>
					(10)以非法民间组织名义活动的；<br>
					(11)含有法律、行政法规禁止的其他内容的。<br>
					4.3 用户承诺对其发表或者上传于本站的所有信息(即属于《中华人民共和国著作权法》规定的作品，包括但不限于文字、图片、音乐、电影、表演和录音录像制品和电脑程序等)均享有完整的知识产权，或者已经得到相关权利人的合法授权；如用户违反本条规定造成本站被第三人索赔的，用户应全额补偿本站一切费用(包括但不限于各种赔偿费、诉讼代理费及为此支出的其它合理费用)；<br>
					4.4 当第三方认为用户发表或者上传于本站的信息侵犯其权利，并根据《信息网络传播权保护条例》或者相关法律规定向本站发送权利通知书时，用户同意本站可以自行判断决定删除涉嫌侵权信息，除非用户提交书面证据材料排除侵权的可能性，本站将不会自动恢复上述删除的信息；<br>
					(1)不得为任何非法目的而使用网络服务系统；<br>
					(2)遵守所有与网络服务有关的网络协议、规定和程序； (3)不得利用本站进行任何可能对互联网的正常运转造成不利影响的行为；<br>
					(4)不得利用本站进行任何不利于本站的行为。<br>
					4.5 如用户在使用网络服务时违反上述任何规定，本站有权要求用户改正或直接采取一切必要的措施(包括但不限于删除用户张贴的内容、暂停或终止用户使用网络服务的权利)以减轻用户不当行为而造成的影响。<br>
					<h3>五、隐私保护</h3>
					5.1 本站不对外公开或向第三方提供单个用户的注册资料及用户在使用网络服务时存储在本站的非公开内容，但下列情况除外：<br>
					(1)事先获得用户的明确授权；<br>
					(2)根据有关的法律法规要求；<br>
					(3)按照相关政府主管部门的要求；<br>
					(4)为维护社会公众的利益。<br>
					5.2 本站可能会与第三方合作向用户提供相关的网络服务，在此情况下，如该第三方同意承担与本站同等的保护用户隐私的责任，则本站有权将用户的注册资料等提供给该第三方。<br>
					5.3 在不透露单个用户隐私资料的前提下，本站有权对整个用户数据库进行分析并对用户数据库进行商业上的利用。<br>
					<h3>六、版权声明</h3>
					6.1 本站的文字、图片、音频、视频等版权均归永兴元科技有限公司享有或与作者共同享有，未经本站许可，不得任意转载。<br>
					6.2 本站特有的标识、版面设计、编排方式等版权均属永兴元科技有限公司享有，未经本站许可，不得任意复制或转载。<br>
					6.3 使用本站的任何内容均应注明“来源于保宝网”及署上作者姓名，按法律规定需要支付稿酬的，应当通知本站及作者及支付稿酬，并独立承担一切法律责任。<br>
					6.4 本站享有所有作品用于其它用途的优先权，包括但不限于网站、电子杂志、平面出版等，但在使用前会通知作者，并按同行业的标准支付稿酬。<br>
					6.5 本站所有内容仅代表作者自己的立场和观点，与本站无关，由作者本人承担一切法律责任。<br>
					6.6 恶意转载本站内容的，本站保留将其诉诸法律的权利。<br>
					<h3>七、责任声明</h3>
					7.1 用户明确同意其使用本站网络服务所存在的风险及一切后果将完全由用户本人承担，保宝网对此不承担任何责任。<br>
					7.2 本站无法保证网络服务一定能满足用户的要求，也不保证网络服务的及时性、安全性、准确性。<br>
					7.3 本站不保证为方便用户而设置的外部链接的准确性和完整性，同时，对于该等外部链接指向的不由本站实际控制的任何网页上的内容，本站不承担任何责任。<br>
					7.4 对于因不可抗力或本站不能控制的原因造成的网络服务中断或其它缺陷，本站不承担任何责任，但将尽力减少因此而给用户造成的损失和影响。<br>
					7.5 对于站向用户提供的下列产品或者服务的质量缺陷本身及其引发的任何损失，本站无需承担任何责任：<br>
					(1)本站向用户免费提供的各项网络服务；<br>
					(2)本站向用户赠送的任何产品或者服务。<br>
					7.6 本站有权于任何时间暂时或永久修改或终止本服务(或其任何部分)，而无论其通知与否，本站对用户和任何第三人均无需承担任何责任。<br>
					<h3>八、附则</h3>
					8.1 本协议的订立、执行和解释及争议的解决均应适用中华人民共和国法律。<br>
					8.2 如本协议中的任何条款无论因何种原因完全或部分无效或不具有执行力，本协议的其余条款仍应有效并且有约束力。<br>
					8.3 本协议解释权及修订权归深圳永兴元科技有限公司所有。<br>
					</p>
					<table width="100%" cellspacing="0" cellpadding="0" style="margin-left: 10px">
						 <tr>
							 <td width="50%"><strong>甲方:</strong><input type="text" readonly="readonly" id="landlordName" style="BORDER-TOP-STYLE: none; BORDER-RIGHT-STYLE: none; BORDER-LEFT-STYLE: none; BORDER-BOTTOM-STYLE: solid"></input><br>
								 <strong>身份证号:</strong><input type="text" readonly="readonly" id="landlordCard" style="BORDER-TOP-STYLE: none; BORDER-RIGHT-STYLE: none; BORDER-LEFT-STYLE: none; BORDER-BOTTOM-STYLE: solid"></input><br>
								 <strong>时间:</strong> 2021年1月2号
							 </td>
							 <td width="50%"><strong>乙方:</strong><input type="text" readonly="readonly" id="customerName" style="BORDER-TOP-STYLE: none; BORDER-RIGHT-STYLE: none; BORDER-LEFT-STYLE: none; BORDER-BOTTOM-STYLE: solid"></input><br>
							 <strong>身份证号:</strong><input type="text" readonly="readonly" id="customerCard" style="BORDER-TOP-STYLE: none; BORDER-RIGHT-STYLE: none; BORDER-LEFT-STYLE: none; BORDER-BOTTOM-STYLE: solid"></input><br>
							 <strong>时间:</strong> 2021年1月2号
						 </td>
						  </table>
				</form>
			</div>
			<!--添加和修改的弹出层结束-->

			<!--选择菜单和权限的弹出层开始-->
			<div id="selectuserDiv" style="display: none;padding: 0.3125rem;">
				<table class="layui-hide" id="roleTable" lay-filter="roleTable"></table>
			</div>
			<!--选择菜单和权限的弹出层结束-->

		</div>
	</div>
	<script src="../../../layuiadmin/lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
	<script src="../../../layuiadmin/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
	<script src="../../../layuiadmin/layui/lay-config.js?v=1.0.4" charset="utf-8"></script>
	<script src="../../../layuiadmin/lib/jq-module/jquery.particleground.min.js" charset="utf-8"></script>
	<script src="../../../layuiadmin/lib/common/jquery.cookie.min.js" charset="utf-8"></script>
	<script src="../../../layuiadmin/lib/common/common.js" charset="utf-8"></script>
	<script src="../../../layuiadmin/lib/common/selectLayer.js" charset="utf-8"></script>
	<script>
		layui.use(['form', 'table', 'laydate', 'layer', 'treeTable','upload', 'layarea'], function () {
			var form = layui.form;
			var table = layui.table;
			var laydate = layui.laydate;
			var layer = layui.layer;
			var treeTable = layui.treeTable;
            var upload = layui.upload ;
            var layarea = layui.layarea ;
			//alert($.cookie('TOKEN'));
			//文件上传

            layarea.render({
                elem: '#area-picker',
                change: function (res) {
                    //选择结果
                    console.log(res);
                }
            });



			laydate.render({
				elem:'#hiredate',
				type:'datetime'
			});

				//示范一个公告层
			var tableIns = table.render({
				elem: '#userTable',
				url: api + 'lease/findAllLease',
				toolbar: "#userToolBar",
				cellMinWidth: true,
				height: 'full-200',
				cols: [[
					{ field: 'id', title: 'ID', align: "center", width: 80 , class:"layui-btn layui-btn-xs layui-btn-warm"},
                    { field: 'contractId', title: 'contractId', align: "center", width: 80,hidden:false },
					{ field: 'houseCode', title: '房屋编号', align: "center", width: 120 },
					{ field: 'customerName', title: '租客名称', align: "center", width: 120 },
					{ field: 'customerCard', title: '身份证号', align: "center", width: 120 },
                    { field: 'customerPhone', title: '联系方式', align: "center", width: 120 },
                    { field: 'price', title: '租价', align: "center", width: 120 },
                    { field: 'customerAddress', title: '地址', align: "center", width: 120 },
					{
						field: 'statu', title: '出租状态', align: "center", templet: function (d) {
							return d.statu == 0 ? '租赁中..' : '已退租';
						}, width: 80
					},
					{ title: '操作', width: 240, templet: '#userTableBar', fixed: "right", align: "center" }
				]],
				page: true
			});

			// 监听搜索操作
			form.on('submit(data-search-btn)', function (data) {
				var params = $("#searchFrm").serialize();
				//执行搜索重载
				table.reload('userTable', {
					page: {
						curr: 1
					},
					url: api + 'house/houseManager?' + params
				});
				return false;
			});

			//监听表头的事件
			table.on('toolbar(userTable)', function (obj) {
				var checkStatus = table.checkStatus(obj.config.id);
				switch (obj.event) {
					case 'batchdelete':
						batchdelete();
						break;
					case 'add':
						openAddUser();
						break;
				};
			});


			// 监听添加和修改弹出层的部门选中
			$("#doDataFromSelectDept").click(function () {
				var f_id = $("#landlordId").val();
				// 参数一 回调信息
                openLandlord( f_id, function (id, name) {
					$("#landlordId").val(id);
					$("#deptid_name").val(name);
				});
			});
			
			
			// 监听搜索  选中部门
			$("#doSelectDept").click(function () {
				var f_id = $("#landlordId").val();
				// 参数一 回调信息
                openLandlord( f_id, function (id, name) {
					$("#landlordId").val(id);
					$("#p_deptname").val(name);
				});
			});


			//监听行数据的事件
			table.on('tool(userTable)', function (obj) {
				var data = obj.data;
				if (obj.event === 'delete') {
					layer.confirm('真的删除【' + data.houseCode + '】这个用户吗么', function (index) {
                        $.get(api + "house/deleteHouse", { id: data.id }, function (res) {
                            layer.msg(res.msg);
                            obj.del();
                            layer.close(index);
                        })

					});
				} else if (obj.event === 'checkContract') {
					openUpdateUser(data);
				}
			});


			// 打开添加用户弹出层
			var maxIndex;
			var url;
			function openAddUser(){
				mainIndex=layer.open({
					type:1,
					title:'添加用户',
					content:$("#addOrUpdateDiv"),
					area:['800px','500px'],
					success:function(index){
						url=api+"house/saveHouse";
						// 重置表单
						$("#dataFrm")[0].reset();
						// 查询最大排序码

					}
				});
			}
			// 打开修改用户的弹出层
			function openUpdateUser(data){

				mainIndex = layer.open({
					type: 1,
					title: '查看合同',
					content: $("#addOrUpdateDiv"),
					area: ['1000px', '600px'],
					success: function (index) {
						//装载数据表格
						//根据部门ID查询部门名称
						$.get(api + "contract/getContractById", { id: data.contractId }, function (res) {
                            $("#customerName").val(res.data.customerVO.name);
                            $("#customerCard").val(res.data.customerVO.cardId);
                            $("#landlordCard").val(res.data.landlordVO.cardId);
                            $("#landlordName").val(res.data.landlordVO.name);
						});
					}
				});
			}
            var token = $.cookie('TOKEN');
			// 监听 添加和修改的提交
			form.on("submit(doSubmit)", function (data) {
				// 提交数据
                $.ajax({
                    url: url,
                    type: "POST",
                    data: JSON.stringify(data.field),
                    dataType: "json",
                    contentType:'application/json;charset=UTF-8',  //设置后
					success: function (result) {
                        layer.msg(result.msg);
                        if (result.code == 200) {
                            tableIns.reload();
                        }
                        layer.close(mainIndex);
                    },
                    error: function () {
                        alert("提交请求失败！");
                    }
                });
				return false;
			});
            // 打开分配角色窗口 roleTable
            function openSelectRole(data_table) {
                var table_RolesIns;
                mainIndex = layer.open({

                    type: 1,
                    title: '分配【' + data_table.houseCode + '】房东',
                    content: $("#selectRoleDiv"),
                    area: ['800px', '600px'],
                    btn: ['<span class="layui-icon layui-icon-ok">确认分配</span>'],
                    btnAlign: 'c',
                    yes: function () {
                        // 获取选中的数据行
                        var checkStatus = table.checkStatus('roleTable');
                        var m = checkStatus.data;
                        // 获取当前行点击的用户id
                        var uid = data_table.id;
                        var params = "uid=" + uid;
                        $.each(m, function (x, item) {
                            params += "&rids=" + item.id;
                        });
                        $.post(api + "user/saveUserRole", params, function (res) {
                            layer.msg(res.msg);
                            layer.close(mainIndex)
                        })
                    },
                    success: function (index) {
                        // 加载角色数据    根据用户id查询该用户拥有的角色id
                        table_RolesIns = table.render({
                            elem: '#roleTable',
                            url: api + 'role/loadAllAvailableRoleNoPage?userId=' + data_table.id,
                            toolbar: false,
                            cellMinWidth: true,

                            cols: [[
                                {type: "checkbox", fixed: "left"},
                                {field: 'id', title: 'ID', align: "center"},
                                {field: 'name', title: '角色标题', align: "center"},
                                {field: 'remark', title: '角色备注', align: "center"}
                            ]]

                        });

                    }
                });
            }

		});
	</script>

</body>

</html>